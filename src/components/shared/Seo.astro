---
type SeoData = {
	title: string
	description: string
	canonical: string
	ogImage: string
	ogImageAlt: string
	locale: string
	type: string
	twitterCard: string
	language: string
	updatedAt: string
}

type PersonData = {
	name: string
	role: string
	email: string
	location: string
	image: string
	sameAs: string[]
}

type FaqItem = { question: string; answer: string }

type Props = {
	seo: SeoData
	person: PersonData
	faq: { items: FaqItem[] }
}

const { seo, person, faq } = Astro.props

const canonicalURL = new URL(seo.canonical || Astro.url.pathname, Astro.site)
const ogImage = new URL(seo.ogImage, Astro.site)
const siteURL = new URL('/', Astro.site).href

const structuredData = {
	'@context': 'https://schema.org',
	'@graph': [
		{
			'@type': 'Person',
			name: person.name,
			jobTitle: person.role,
			email: person.email,
			image: new URL(person.image, Astro.site).href,
			url: siteURL,
			sameAs: person.sameAs,
		},
		{
			'@type': 'WebSite',
			name: seo.title,
			url: siteURL,
			description: seo.description,
			inLanguage: seo.language,
		},
		{
			'@type': 'WebPage',
			name: seo.title,
			description: seo.description,
			url: canonicalURL.href,
			inLanguage: seo.language,
			dateModified: seo.updatedAt,
			about: {
				'@type': 'Person',
				name: person.name,
			},
		},
		[
			{
				'@type': 'FAQPage',
				mainEntity: faq.items.map((item) => ({
					'@type': 'Question',
					name: item.question,
					acceptedAnswer: {
						'@type': 'Answer',
						text: item.answer,
					},
				})),
			},
		],
	],
}
---

<meta name="description" content={seo.description} />
<meta name="robots" content="index,follow" />
<meta name="author" content={person.name} />
<link rel="canonical" href={canonicalURL.href} />
<meta property="og:title" content={seo.title} />
<meta property="og:description" content={seo.description} />
<meta property="og:type" content={seo.type} />
<meta property="og:url" content={canonicalURL.href} />
<meta property="og:image" content={ogImage.href} />
<meta property="og:image:alt" content={seo.ogImageAlt} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:type" content="image/webp" />
<meta property="og:locale" content={seo.locale} />
<meta property="og:site_name" content={seo.title} />
<meta name="twitter:card" content={seo.twitterCard} />
<meta name="twitter:title" content={seo.title} />
<meta name="twitter:description" content={seo.description} />
<meta name="twitter:image" content={ogImage.href} />
<meta name="twitter:image:alt" content={seo.ogImageAlt} />
<title>{seo.title}</title>
<script
	is:inline
	type="application/ld+json"
	set:html={JSON.stringify(structuredData).replace(/</g, '\\u003c')}
/>
