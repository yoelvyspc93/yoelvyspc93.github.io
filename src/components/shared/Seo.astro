---
type SeoData = {
	title: string
	description: string
	canonicalPath: string
	ogImage: string
	locale: string
	type: string
	twitterCard: string
	language: string
}

type PersonData = {
	name: string
	role: string
	email: string
	location: string
	image: string
	sameAs: string[]
}

type FaqItem = { question: string; answer: string }

type Props = {
	seo: SeoData
	person: PersonData
	faq: { items: FaqItem[] }
}

const { seo, person, faq } = Astro.props

const canonicalURL = new URL(seo.canonicalPath || Astro.url.pathname, Astro.site)
const ogImage = new URL(seo.ogImage, Astro.site)

const structuredData = [
	{
		'@context': 'https://schema.org',
		'@type': 'Person',
		name: person.name,
		jobTitle: person.role,
		email: person.email,
		image: new URL(person.image, Astro.site).href,
		url: canonicalURL.href,
		sameAs: person.sameAs,
	},
	{
		'@context': 'https://schema.org',
		'@type': 'WebSite',
		name: seo.title,
		url: canonicalURL.href,
		description: seo.description,
		inLanguage: seo.language,
	},
	{
		'@context': 'https://schema.org',
		'@type': 'WebPage',
		name: seo.title,
		description: seo.description,
		url: canonicalURL.href,
		inLanguage: seo.language,
		about: {
			'@type': 'Person',
			name: person.name,
		},
	},
	...(faq.items.length
		? [
				{
					'@context': 'https://schema.org',
					'@type': 'FAQPage',
					mainEntity: faq.items.map((item) => ({
						'@type': 'Question',
						name: item.question,
						acceptedAnswer: {
							'@type': 'Answer',
							text: item.answer,
						},
					})),
				},
			]
		: []),
]
---

<meta name="description" content={seo.description} />
<meta name="robots" content="index,follow" />
<meta name="author" content={person.name} />
<link rel="canonical" href={canonicalURL.href} />
<meta property="og:title" content={seo.title} />
<meta property="og:description" content={seo.description} />
<meta property="og:type" content={seo.type} />
<meta property="og:url" content={canonicalURL.href} />
<meta property="og:image" content={ogImage.href} />
<meta property="og:locale" content={seo.locale} />
<meta property="og:site_name" content={seo.title} />
<meta name="twitter:card" content={seo.twitterCard} />
<meta name="twitter:title" content={seo.title} />
<meta name="twitter:description" content={seo.description} />
<meta name="twitter:image" content={ogImage.href} />
<title>{seo.title}</title>
<script type="application/ld+json">
	{JSON.stringify(structuredData)}
</script>
