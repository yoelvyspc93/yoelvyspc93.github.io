---
import ExperienceItem from '@/shared/ExperienceItem.astro'
import { getCollection, render } from 'astro:content'

type Props = {
	content: {
		title: string
		accent: string
	}
}

const { content } = Astro.props
const timelineLabel = 'Experience timeline'

const entries = await getCollection('experience')

const items = await Promise.all(
	entries
		.sort((a, b) => a.data.order - b.data.order)
		.map(async (entry) => {
			const { Content } = await render(entry)

			return {
				period: entry.data.period,
				company: entry.data.company,
				rol: entry.data.rol,
				image: entry.data.image,
				Content,
			}
		}),
)
---

<section
	id="experience"
	aria-labelledby="experience-heading"
	class="section-container py-16 sm:py-20 md:py-28 lg:py-36"
>
	<div
		class="mx-auto flex w-full max-w-[560px] lg:max-w-7xl flex-col items-center justify-center gap-8 sm:gap-10"
	>
		<header class="text-center">
			<h2 id="experience-heading">
				{content.title}
				<span>{content.accent}</span>
			</h2>
		</header>

		<ol
			class="relative flex flex-col gap-10 pl-[clamp(52px,12vw,120px)]"
			aria-label={timelineLabel}
		>
			<li
				aria-hidden="true"
				class="pointer-events-none absolute bottom-0 left-[clamp(22px,7vw,50px)] top-3 w-[4px] overflow-hidden bg-primary md:w-[5px]"
			>
				<span
					class="absolute inset-0 bg-linear-gradient"
					style="
            -webkit-mask-image: linear-gradient(to bottom, black 75%, transparent 100%);
            -webkit-mask-repeat: no-repeat;
            -webkit-mask-size: 100% 100%;
            mask-image: linear-gradient(to bottom, black 90%, transparent 100%);
            mask-repeat: no-repeat;
            mask-size: 100% 100%;
          "
				></span>
			</li>

			{items.map((item, index) => <ExperienceItem item={item} index={index} />)}
		</ol>
	</div>
</section>
