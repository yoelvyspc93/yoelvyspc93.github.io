---
import { ClientRouter } from 'astro:transitions'
import Navigator from '@/shared/Navigator.astro'
// import SlidingMenu from '@/shared/SlidingMenu.astro'

import '@/styles/global.css'
import Footer from '@/shared/Footer.astro'
import { getEntry } from 'astro:content'

const home = await getEntry('home', 'home')
const seo = await getEntry('seo', 'seo')
const person = await getEntry('person', 'person')
const navigation = await getEntry('navigation', 'navigation')
const footer = await getEntry('footer', 'footer')

if (!home || !seo || !person || !navigation || !footer) {
	throw new Error('Home content entry not found.')
}

const { faq } = home.data

const canonicalURL = new URL(
	seo.data.canonicalPath || Astro.url.pathname,
	Astro.site,
)
const ogImage = new URL(seo.data.ogImage, Astro.site)

const structuredData = [
	{
		'@context': 'https://schema.org',
		'@type': 'Person',
		name: person.data.name,
		jobTitle: person.data.role,
		email: person.data.email,
		image: new URL(person.data.image, Astro.site).href,
		url: canonicalURL.href,
		sameAs: person.data.sameAs,
	},
	{
		'@context': 'https://schema.org',
		'@type': 'WebSite',
		name: seo.data.title,
		url: canonicalURL.href,
		description: seo.data.description,
		inLanguage: seo.data.language,
	},
	{
		'@context': 'https://schema.org',
		'@type': 'WebPage',
		name: seo.data.title,
		description: seo.data.description,
		url: canonicalURL.href,
		inLanguage: seo.data.language,
		about: {
			'@type': 'Person',
			name: person.data.name,
		},
	},
	...(faq.items.length
		? [
				{
					'@context': 'https://schema.org',
					'@type': 'FAQPage',
					mainEntity: faq.items.map((item) => ({
						'@type': 'Question',
						name: item.question,
						acceptedAnswer: {
							'@type': 'Answer',
							text: item.answer,
						},
					})),
				},
			]
		: []),
]
---

<!doctype html>
<html lang={seo.data.language}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap"
		/>
		<meta name="description" content={seo.data.description} />
		<meta name="robots" content="index,follow" />
		<meta name="author" content={person.data.name} />
		<link rel="canonical" href={canonicalURL.href} />
		<meta property="og:title" content={seo.data.title} />
		<meta property="og:description" content={seo.data.description} />
		<meta property="og:type" content={seo.data.type} />
		<meta property="og:url" content={canonicalURL.href} />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<meta property="og:image" content={ogImage.href} />
		<meta property="og:locale" content={seo.data.locale} />
		<meta property="og:site_name" content={seo.data.title} />
		<meta name="twitter:card" content={seo.data.twitterCard} />
		<meta name="twitter:title" content={seo.data.title} />
		<meta name="twitter:description" content={seo.data.description} />
		<meta name="twitter:image" content={ogImage.href} />
		<meta name="theme-color" content="#ffffff" />
		<meta name="color-scheme" content="light" />
		<meta name="generator" content={Astro.generator} />
		<title>{seo.data.title}</title>
		<script type="application/ld+json">
			{JSON.stringify(structuredData)}
		</script>
		<ClientRouter />
	</head>
	<body>
		<a href="#main-content" class="skip-link">Skip to main content</a>
		<Navigator navigation={navigation.data} />
		<!-- <SlidingMenu /> -->
		<slot />
		<Footer footer={footer.data} />
	</body>
</html>
